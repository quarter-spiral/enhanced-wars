radio = require('radio')

exports class GameRenderer
  constructor: (@game) ->
    self = @

    CAAT.Module.Initialization.TemplateWithSplash.init(
      # canvas will be 800x600 pixels
      800, 600,

      # and will be added to the end of document. set an id of a canvas or div element
      'game',

      # keep splash at least this 2000 milliseconds
      <%= ENV['RACK_ENV'] == 'production' ? 2000 : 500 %>,

      # load these images and set them up for non splash scenes.
      # image elements must be of the form:
      # {id:'<unique string id>',    url:'<url to image>'}
      # No images can be set too.
      [],

      # onEndSplash callback function.
      # Create your scenes on this method.
      (director) ->
        self.preloader = new CAAT.Module.Preloader.Preloader()

        self.director = director
        self.scene = director.createScene()
        MapRenderer = require('MapRenderer')
        @mapRenderer = new MapRenderer(self.game, self)

        self.preloader.load (images) ->
          director.setImagesCache(images)
          radio("ew/renderer/assets-loaded").broadcast(self, images)

        CAAT.loop(60)
      ,

      # use this image as splash. It will cover all of director's area. optional.
      "/assets/splash.png"
    )

